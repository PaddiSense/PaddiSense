button_card_templates:
  forecast_temp_tile:
    show_icon: true
    show_name: true
    show_state: true
    layout: vertical
    state_display: |
      [[[
        const v = parseFloat(entity?.state);
        if (Number.isNaN(v)) return '—';
        return `${v.toFixed(1)}°C`;
      ]]]
    styles:
      card:
        - border-radius: 14px
        - padding: 10px
        - box-shadow: none
        - background: |
            [[[
              const raw = entity?.state;
              const v = parseFloat(raw);

              const mode = String(variables?.mode ?? 'min').toLowerCase();
              const lo = Number(variables?.lo ?? 0);
              const hi = Number(variables?.hi ?? 40);
              const step = Number(variables?.step ?? 2);
              const alpha = Number(variables?.alpha ?? 0.30);

              // Unknown/unavailable
              if (raw === undefined || raw === null || ['unknown','unavailable','none',''].includes(String(raw).toLowerCase()) || Number.isNaN(v)) {
                return 'rgba(120,120,120,0.12)';
              }

              // Clamp + band
              const clamped = Math.min(hi, Math.max(lo, v));
              const bands = Math.max(1, Math.ceil((hi - lo) / step));
              const bandIndex = Math.min(bands - 1, Math.max(0, Math.floor((clamped - lo) / step)));
              const t = (bands <= 1) ? 0 : bandIndex / (bands - 1); // 0..1

              // Helpers
              const lerp = (a,b,t) => a + (b-a)*t;
              const mixRGB = (c1,c2,t) => {
                const r = Math.round(lerp(c1[0], c2[0], t));
                const g = Math.round(lerp(c1[1], c2[1], t));
                const b = Math.round(lerp(c1[2], c2[2], t));
                return `rgba(${r},${g},${b},${alpha})`;
              };

              // Stronger, more obvious gradients
              // Min: deep blue -> cyan -> greenish
              // Max: yellow -> orange -> deep red
              if (mode === 'min') {
                const cold1 = [  0, 110, 255];  // deep-ish blue
                const cold2 = [  0, 210, 255];  // cyan
                const cold3 = [ 70, 255, 190];  // green-cyan
                return (t < 0.5)
                  ? mixRGB(cold1, cold2, t / 0.5)
                  : mixRGB(cold2, cold3, (t - 0.5) / 0.5);
              } else {
                const hot1  = [255, 235,  80];  // yellow
                const hot2  = [255, 150,   0];  // orange
                const hot3  = [230,  40,  40];  // red
                return (t < 0.5)
                  ? mixRGB(hot1, hot2, t / 0.5)
                  : mixRGB(hot2, hot3, (t - 0.5) / 0.5);
              }
            ]]]
      icon:
        - width: 34px
        - color: |
            [[[
              const mode = String(variables?.mode ?? 'min').toLowerCase();
              return (mode === 'max') ? 'rgba(255,140,0,0.95)' : 'rgba(80,160,255,0.95)';
            ]]]
      name:
        - font-size: 13px
        - font-weight: 600
        - opacity: 0.95
      state:
        - font-size: 26px
        - font-weight: 800
        - line-height: 1.1
    tap_action:
      action: more-info
  forecast_date_tile:
    show_icon: true
    show_name: true
    show_state: true
    layout: vertical
    tap_action:
      action: none
    name: |
      [[[
        const off = Number(variables?.offset ?? 0);
        const d = new Date();
        d.setDate(d.getDate() + off);
        return d.toLocaleDateString(undefined, { weekday: 'short' });
      ]]]
    state_display: |
      [[[
        const off = Number(variables?.offset ?? 0);
        const d = new Date();
        d.setDate(d.getDate() + off);
        return d.toLocaleDateString(undefined, { day: '2-digit', month: 'short' });
      ]]]
    styles:
      card:
        - border-radius: 14px
        - padding: 10px
        - background: rgba(120,120,120,0.10)
        - box-shadow: none
      icon:
        - width: 34px
        - color: rgba(200,200,200,0.85)
      name:
        - font-size: 14px
        - font-weight: 700
      state:
        - font-size: 12px
        - opacity: 0.8
views:
  

  - title: Forecast
    type: sections
    path: forecast
    max_columns: 3
    sections:
      - type: grid # Platinum Weather Card
        cards:
          - entity_apparent_temp: sensor.bom_temp_feels_like
            entity_extended: sensor.home_forecast_extended_text_1
            entity_forecast_icon: sensor.home_forecast_icon_descriptor_0
            entity_forecast_icon_1: sensor.home_forecast_icon_descriptor_1
            entity_forecast_max: sensor.home_forecast_temp_max_0
            entity_forecast_max_1: sensor.home_forecast_temp_max_1
            entity_forecast_min: sensor.home_forecast_temp_min_0
            entity_forecast_min_1: sensor.home_forecast_temp_min_1
            entity_humidity: sensor.bom_humidity
            entity_pop: sensor.home_forecast_rain_chance_0
            entity_pop_1: sensor.home_forecast_rain_chance_1
            entity_pos: sensor.home_forecast_rain_amount_max_0
            entity_pos_1: sensor.home_forecast_rain_amount_range_1
            entity_summary: sensor.home_forecast_extended_text_0
            entity_summary_1: sensor.home_forecast_extended_text_0
            entity_sun: sun.sun
            entity_temperature: sensor.home_forecast_now_temp_now
            entity_wind_bearing: sensor.bom_wind_direction
            entity_wind_gust: sensor.bom_gust_speed_kilometre
            entity_wind_speed: sensor.bom_wind_speed_kilometre
            extended_use_attr: false
            option_static_icons: false
            option_time_format: 12hour
            section_order:
              - overview
              - slots
              - daily_forecast
              - extended
            show_section_extended: true
            slot_l1: forecast_max
            slot_l2: forecast_min
            slot_l3: wind
            slot_l4: remove
            slot_l5: sun_next
            slot_l6: remove
            slot_l7: remove
            slot_l8: remove
            slot_r1: popforecast
            slot_r2: humidity
            slot_r3: remove
            slot_r4: remove
            slot_r5: sun_following
            slot_r6: remove
            slot_r7: remove
            slot_r8: remove
            text_card_title_2: Old Coree
            type: custom:platinum-weather-card
            daily_extended_forecast_days: 3
            daily_forecast_days: 5
            daily_forecast_layout: vertical
      - type: grid # Rain Radar
        cards:
          - type: custom:weather-radar-card
            data_source: RainViewer-TWC
            map_style: Dark
            center_latitude: -35.34395839537419
            center_longitude: 145.53880716799404
            zoom_level: 7
            marker_latitude: -35.34395839537419
            marker_longitude: 145.53880716799404
            show_marker: true
            show_recenter: true
            show_scale: true
            show_range: true
  - title: Temps
    sections:
      - type: grid
        cards:
          - type: heading
            heading: New section
          - type: vertical-stack
            cards:
              - type: custom:mushroom-title-card
                title: 7-Day Temperature (Min / Max)
                subtitle: Rolling forecast (2°C colour bands)
              - type: grid
                columns: 3
                square: false
                cards:
                  - type: custom:button-card
                    template: forecast_date_tile
                    icon: mdi:calendar-today
                    variables:
                      offset: 0
                  - type: custom:button-card
                    template: forecast_temp_tile
                    entity: sensor.home_forecast_temp_min_0
                    name: Min
                    icon: mdi:thermometer-low
                    variables:
                      mode: min
                      lo: -4
                      hi: 25
                      step: 1
                      alpha: 0.8
                  - type: custom:button-card
                    template: forecast_temp_tile
                    entity: sensor.home_forecast_temp_max_0
                    name: Max
                    icon: mdi:thermometer-high
                    variables:
                      mode: max
                      lo: 20
                      hi: 45
                      step: 1
                      alpha: 0.8
                  - type: custom:button-card
                    template: forecast_date_tile
                    icon: mdi:calendar
                    variables:
                      offset: 1
                  - type: custom:button-card
                    template: forecast_temp_tile
                    entity: sensor.home_forecast_temp_min_1
                    name: Min
                    icon: mdi:thermometer-low
                    variables:
                      mode: min
                      lo: -4
                      hi: 25
                      step: 1
                      alpha: 0.8
                  - type: custom:button-card
                    template: forecast_temp_tile
                    entity: sensor.home_forecast_temp_max_1
                    name: Max
                    icon: mdi:thermometer-high
                    variables:
                      mode: max
                      lo: 20
                      hi: 45
                      step: 1
                      alpha: 0.8
                  - type: custom:button-card
                    template: forecast_date_tile
                    icon: mdi:calendar
                    variables:
                      offset: 2
                  - type: custom:button-card
                    template: forecast_temp_tile
                    entity: sensor.home_forecast_temp_min_2
                    name: Min
                    icon: mdi:thermometer-low
                    variables:
                      mode: min
                      lo: -4
                      hi: 20
                      step: 2
                      alpha: 0.8
                  - type: custom:button-card
                    template: forecast_temp_tile
                    entity: sensor.home_forecast_temp_max_2
                    name: Max
                    icon: mdi:thermometer-high
                    variables:
                      mode: max
                      lo: 20
                      hi: 45
                      step: 1
                      alpha: 0.8
                  - type: custom:button-card
                    template: forecast_date_tile
                    icon: mdi:calendar
                    variables:
                      offset: 3
                  - type: custom:button-card
                    template: forecast_temp_tile
                    entity: sensor.home_forecast_temp_min_3
                    name: Min
                    icon: mdi:thermometer-low
                    variables:
                      mode: min
                      lo: -4
                      hi: 20
                      step: 2
                      alpha: 0.8
                  - type: custom:button-card
                    template: forecast_temp_tile
                    entity: sensor.home_forecast_temp_max_3
                    name: Max
                    icon: mdi:thermometer-high
                    variables:
                      mode: max
                      lo: 20
                      hi: 45
                      step: 1
                      alpha: 0.8
                  - type: custom:button-card
                    template: forecast_date_tile
                    icon: mdi:calendar
                    variables:
                      offset: 4
                  - type: custom:button-card
                    template: forecast_temp_tile
                    entity: sensor.home_forecast_temp_min_4
                    name: Min
                    icon: mdi:thermometer-low
                    variables:
                      mode: min
                      lo: -4
                      hi: 20
                      step: 2
                      alpha: 0.8
                  - type: custom:button-card
                    template: forecast_temp_tile
                    entity: sensor.home_forecast_temp_max_4
                    name: Max
                    icon: mdi:thermometer-high
                    variables:
                      mode: max
                      lo: 20
                      hi: 45
                      step: 1
                      alpha: 0.8
                  - type: custom:button-card
                    template: forecast_date_tile
                    icon: mdi:calendar
                    variables:
                      offset: 5
                  - type: custom:button-card
                    template: forecast_temp_tile
                    entity: sensor.home_forecast_temp_min_5
                    name: Min
                    icon: mdi:thermometer-low
                    variables:
                      mode: min
                      lo: -4
                      hi: 20
                      step: 2
                      alpha: 0.8
                  - type: custom:button-card
                    template: forecast_temp_tile
                    entity: sensor.home_forecast_temp_max_5
                    name: Max
                    icon: mdi:thermometer-high
                    variables:
                      mode: max
                      lo: 20
                      hi: 45
                      step: 1
                      alpha: 0.8
                  - type: custom:button-card
                    template: forecast_date_tile
                    icon: mdi:calendar
                    variables:
                      offset: 6
                  - type: custom:button-card
                    template: forecast_temp_tile
                    entity: sensor.home_forecast_temp_min_6
                    name: Min
                    icon: mdi:thermometer-low
                    variables:
                      mode: min
                      lo: -4
                      hi: 20
                      step: 2
                      alpha: 0.8
                  - type: custom:button-card
                    template: forecast_temp_tile
                    entity: sensor.home_forecast_temp_max_6
                    name: Max
                    icon: mdi:thermometer-high
                    variables:
                      mode: max
                      lo: 20
                      hi: 45
                      step: 1
                      alpha: 0.8
